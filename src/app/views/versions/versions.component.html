<div class="animated fadeIn">
  <div class="row">
    <div class="col-sm-12 col-md-12">
      <h1 class="title">
        Manage BoK versions
      </h1>

      <div class="text-center" [hidden]="!isAnonymous">
        <h5>You need to <a href="#" routerLink="/login"> log in </a> to manage BoK versions. </h5>
      </div>

      <div *ngIf="!isAnonymous" class="card card-accent-primary">

        <div class="text-center" *ngIf="fileCS.loading">
          <br>
          <h5>Loading current versions ...</h5>

          <app-loading-indicator style="margin: auto;"></app-loading-indicator>

        </div>

        <br>
        <div class="">
          <div class="row" *ngIf="!fileCS.loading">

            <div *ngFor="let v of fileCS.listKeysAll, index as i" class="col-sm-12 col-md-8 offset-md-2 ">
              <div class="card card-accent-secondary">
                <h3 class="card-header text-center"> {{v}} version - {{fileCS.allBoKs[v].creationYear}}
                </h3>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <p>Total Topics : {{fileCS.allBoKs[v].concepts.length}}</p>
                      <p>Total Learning Objectives : {{fileCS.allBoKs[v].skills.length}}</p>
                      <p>Total Relations : {{fileCS.allBoKs[v].relations.length}}</p>
                      <p>Total References : {{fileCS.allBoKs[v].references.length}}</p>
                      <p>Version number : {{v === 'current' ? fileCS.allBoKs[v].version : v.substring(1)}}</p>
                      <p>Last Updated : {{v === 'current' ? (fileCS.allBoKs[v].updateDate | date:'short') : fileCS.allBoKs[v].creationYear}}</p>
                    </div>
                    <div *ngIf="v == 'current'" class="col-md-6 text-center">
                      <p>
                        Warning! {{fileCS.listKeysAll.length !== 1 ? 
                        'Deleting this version will make the previous version the current one.' : 
                        'Replacing this version will make the new version the current one.'}} 
                      </p>
                      <button type="button" class="btn btn-danger" *ngIf="fileCS.listKeysAll.length !== 1"
                        (click)="deleteModal.show()">Delete</button>
                      <div class="mb-3" *ngIf="fileCS.listKeysAll.length == 1">
                        <ng-select [items]="newBokKeys" name="newBokKeys" bindLabel="name" [multiple]="false"
                          [(ngModel)]="newBokItem">
                          <ng-template ng-optgroup-tmp let-item="item">
                            {{item}}
                          </ng-template>
                        </ng-select>
                      </div>
                      <button type="button" class="btn btn-danger" *ngIf="fileCS.listKeysAll.length == 1"
                        (click)="replaceModal.show()">Replace</button>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <div class="col-sm-12 col-md-8 offset-md-2 text-center">
              <br><br>
              <h5>
                Click this button to restore the previous BoK version from the backup. Warning! This will irreversibly delete all other
                versions of the
                BoK!
              </h5>

              <input class="btn btn-primary" type="button" value="Recover previous version" (click)="restoreModal.show()"
                [disabled]="!hasPermissions">
              <br><br>
            </div>

          </div>

        </div>
      </div>


      <div bsModal #deleteModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Are you sure you want to continue?</h4>
              <button type="button" class="close" (click)="deleteModal.hide()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>You are about the delete the current online version of the BoK. This will irreversibly delete this BoK
                version, and
                install the previous BoK version as current version. Are you sure you want to continue?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" (click)="deleteModal.hide()">Close</button>
              <button type="button" class="btn btn-danger" (click)="deleteVersionBoK(); deleteModal.hide()">Delete
                version</button>
            </div>
          </div>
        </div>
      </div>

      <div bsModal #replaceModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Are you sure you want to continue?</h4>
              <button type="button" class="close" (click)="replaceModal.hide()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>You are about the replace the current online version of the BoK. This will irreversibly delete this BoK
                version, and
                install the new BoK version as current version. Are you sure you want to continue?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" (click)="replaceModal.hide()">Close</button>
              <button type="button" class="btn btn-danger" (click)="replaceCurrentBok(); replaceModal.hide()">Replace
                version</button>
            </div>
          </div>
        </div>
      </div>

      <div bsModal #restoreModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
        aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Are you sure you want to continue?</h4>
              <button type="button" class="close" (click)="restoreModal.hide()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>You are about to irreversibly delete all BoK versions, and restore the backup BoK version. Are you
                sure you want to
                continue?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" (click)="restoreModal.hide()">Close</button>
              <button type="button" class="btn btn-danger" (click)="recoverFromBackup(); restoreModal.hide()">Restore</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>